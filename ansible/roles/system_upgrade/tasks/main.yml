---
- name: Status check and update
  ansible.builtin.apt:
    state: fixed
    update_cache: true
- name: System upgrade
  ansible.builtin.apt:
    name: "*"
    state: latest
  #  upgrade: dist
    autoremove: true
- name: Set timezone to Europe/Prague
  ansible.builtin.timezone:
    name: Europe/Prague
- name: Install useful packages
  ansible.builtin.apt:
    pkg:
    - apt-transport-https
    - ca-certificates
    - curl
    - htop
    - screen
    - mc
    - sysstat
    - smartmontools
    - lm-sensors
    - fail2ban
    - open-iscsi
    - nfs-common
    - ethtool
- name: Enable sysstat in /etc/default/sysstat
  ansible.builtin.lineinfile:
    path: /etc/default/sysstat
    regexp: '^ENABLED='
    line: 'ENABLED="true"'
    backup: true
- name: Start the sysstat service
  ansible.builtin.systemd:
    name: sysstat
    state: started
    enabled: true
- name: Ensure a Czech locale exists
  community.general.locale_gen:
    name: cs_CZ.UTF-8
    state: present
- name: Set as default locale
  ansible.builtin.command: localectl set-locale LANG=cs_CZ.UTF-8 LANGUAGE=CZ.UTF-8 LC_MESSAGES=cs_CZ.UTF-8 LC_TIME=cs_CZ.UTF-8
  when: not ('cs_CZ.UTF-8' in ansible_env | lower)
